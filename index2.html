<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é­”æ³•è£å‚™</title>
<style>
  body {
    background: radial-gradient(circle at top, #222, #111);
    color: #fff;
    font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
    text-align: center;
    margin:0; padding:0;
  }
  h1 { margin: 20px 0; }

.tab-btn {
background: #444;
color: #fff;
border: none;
padding: 8px 16px;
margin: 0 4px;
border-radius: 8px;
cursor: pointer;
}
.tab-btn:hover { background: #666; }

.page { display: none; }

.equip-container {
position: relative;
width: 320px;
height: 460px;
margin: 20px auto;
border: 3px solid #555;
border-radius: 12px;
background: rgba(255,255,255,0.05);
box-shadow: 0 0 10px #333 inset;
}
.equip-slot {
position: absolute;
width: 64px;
height: 64px;
border: 2px solid #777;
border-radius: 8px;
background: rgba(255,255,255,0.1);
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
transition: 0.2s;
font-size: 32px;
}
.equip-slot:hover { border-color: gold; transform: scale(1.05); }

.head { top: 20px; left: 128px; }
.neck { top: 100px; left: 128px; }
.body { top: 180px; left: 128px; }
.waist { top: 260px; left: 128px; }
.hands { top: 180px; left: 48px; }
.weapon { top: 180px; left: 208px; }
.legs { top: 260px; left: 48px; }
.boots { top: 260px; left: 208px; }
.accessory { top: 340px; left: 128px; }

.storage-box {
width: 320px;
margin: 20px auto;
border: 2px solid #555;
border-radius: 10px;
background: rgba(255,255,255,0.05);
padding: 10px;
}
.storage-item {
display: inline-block;
font-size: 28px;
margin: 4px;
cursor: pointer;
}

.student-select {
margin-top: 10px;
font-size: 16px;
padding: 4px 8px;
border-radius: 6px;
border: none;
background: #333;
color: white;
}

.tooltip {
position: fixed;
bottom: 30px;
left: 50%;
transform: translateX(-50%);
background: rgba(50,50,50,0.95);
color: #fff;
padding: 10px 16px;
border-radius: 8px;
display: none;
max-width: 80%;
}

.student {
background: rgba(255,255,255,0.05);
border: 2px solid #555;
border-radius: 10px;
margin: 10px auto;
padding: 10px;
width: 90%;
max-width: 500px;
box-shadow: 0 0 10px #333 inset;
font-size: 14px;
}
.equip-line {
display: flex;
justify-content: space-between;
padding: 4px 10px;
border-bottom: 1px solid #444;
}
.equip-line:last-child { border-bottom: none; }
.icon { font-size: 24px; }

.back-btn {
background: #444;
color: #fff;
border: none;
padding: 8px 16px;
border-radius: 8px;
cursor: pointer;
margin-bottom: 20px;
}
.back-btn:hover { background: #666; }

.power-box { margin-top:8px; color:#ffd670; font-weight:700; }
</style>

</head>
<body>

<h1>é­”æ³•å¸«è£å‚™</h1>
<div>
  <button class="tab-btn" data-page="equipPage">é­”æ³•è£å‚™</button>
  <button class="tab-btn" data-page="allPage">å…¨å“¡ä¸€è¦½</button>
  <button class="tab-btn" data-page="catalogPage">è£å‚™å¤§å…¨</button>
  <button onclick="window.location.href='index.html'" 
          style="background:#222244; color:#ffd700; border:1px solid #ffd700; 
                 padding:10px 20px; border-radius:8px; font-weight:bold; cursor:pointer;">
    é­”æ³•è­°æœƒ
  </button>
  <button onclick="window.location.href='index3.html'" 
          style="background:#222244; color:#ffd700; border:1px solid #ffd700; 
                 padding:10px 20px; border-radius:8px; font-weight:bold; cursor:pointer;">
    é­”æ³•å•†åº—
  </button>
</div>

<div class="page" id="equipPage">
  <select id="studentSelect" class="student-select"></select>

  <div id="powerTotal" class="power-box">ç¸½åŠ æ¬Šï¼š0.000%</div>
  <div class="equip-container" id="equipContainer"></div>

  <div class="storage-box" id="storageBox">
    <h3>å€‰åº«</h3>
    <div id="storageItems"></div>
  </div>
</div>

<div class="page" id="allPage">
  <div id="allContainer"></div>
</div>

<div class="page" id="catalogPage">
  <input type="text" id="catalogSearch" placeholder="ğŸ” æœå°‹è£å‚™åç¨±æˆ–èªªæ˜ï¼ˆå¯è¼¸å…¥åŠ æ¬Šæ•¸å­—ç‰‡æ®µï¼‰" style="width:90%;max-width:400px;margin:10px 0;padding:6px;border-radius:6px;border:none;font-size:16px;">
  <div id="catalogContainer"></div>
</div>

<div id="tooltip" class="tooltip"></div>

<script>
const equipSlots = [
  "head","body","hands","weapon","legs","boots",
  "neck","waist","accessory"
];

// åˆå§‹åŒ– 29 åå­¸ç”Ÿ
const equipData = Array.from({length:29}, (_,i)=>{
  const student={name:`ã€${i+1}ã€‘é­”æ³•å¸«`, storage:[]};
  equipSlots.forEach(slot=>student[slot]=null);
  return student;
});

// helper: éš¨æ©Ÿæˆ–ä¿ç•™æ—¢æœ‰ power
function ensurePower(item){
  if(!item) return item;
  if(item.power === undefined){
    // å¾å¼ä¿ç•™ä¸‰ä½å°æ•¸ï¼Œè¡¨ç¤ºç™¾åˆ†æ¯”æ•¸å€¼ï¼ˆ0.001 ~ 0.999ï¼‰
    item.power = (Math.random()*0.998 + 0.001).toFixed(3);
  }
  return item;
}

// ç¯„ä¾‹è£å‚™ï¼ˆä¸¦åŠ å…¥ powerï¼‰
function newItem(icon,name,desc,power){
  const it={icon,name,desc};
  it.power = (power!==undefined)? Number(power).toFixed(3) : (Math.random()*0.998 + 0.001).toFixed(3);
  return it;
}

// å°‡åŸæœ¬ä½ çµ¦çš„ä¾‹å­åŠ å›ä¾†ä¸¦å¥—ä¸Š power
equipData[23].legs = newItem("ğŸ‘–","èˆè¹ˆè¤²","ã€è…¿éƒ¨ã€‘");
equipData[26].boots = newItem("ğŸ¥¾","æ¢éšªé´","ã€é´å­ã€‘");
equipData[27].neck = newItem("ğŸ“¿","å¹¸é‹é …éŠ","ã€é ¸éƒ¨ã€‘");
equipData[27].waist = newItem("ğŸ€","é­”æ³•è­°æœƒè…°å¸¶","ã€è…°éƒ¨ã€‘");

equipData[28].head = newItem("ğŸ»","æ£•ç†Šå¸½","ã€é ­éƒ¨ã€‘");
equipData[28].body = newItem("ğŸ•","æŠ«è–©","ã€ç›”ç”²ã€‘");
equipData[28].hands = newItem("ğŸ–Šï¸","ç©å…·é‹¼ç­†","ã€æ‰‹éƒ¨ã€‘");
equipData[28].weapon = newItem("ğŸ“š","æ›¸æœ¬","ã€æ­¦å™¨ã€‘");
equipData[28].legs = newItem("ğŸ‘–","èˆè¹ˆè¤²","ã€è…¿éƒ¨ã€‘");
equipData[28].boots = newItem("ğŸ¥¾","æ¢éšªé´","ã€é´å­ã€‘");
equipData[28].neck = newItem("ğŸ“¿","å¹¸é‹é …éŠ","ã€é ¸éƒ¨ã€‘");
equipData[28].waist = newItem("ğŸ€","é­”æ³•è­°æœƒè…°å¸¶","ã€è…°éƒ¨ã€‘");
equipData[28].accessory = newItem("ğŸ–ï¸","é­”æ³•å¾½ç« ","ã€é£¾å“ã€‘");

equipData[28].storage.push(newItem("ğŸ†","å„ªç­‰ç”Ÿçç›ƒ","ã€å…¶ä»–ã€‘"));
// ä½ å¯ä»¥åœ¨æ­¤åŠ å…¥æ›´å¤š storage é …ç›®ï¼š
equipData[28].storage.push(newItem("ğŸ§™â€â™‚ï¸","é­”æ³•å¸½","ã€é ­éƒ¨ã€‘"));
equipData[28].storage.push(newItem("ğŸ‘‘","ç‹å† ","ã€é ­éƒ¨ã€‘"));
equipData[28].storage.push(newItem("ğŸ©","é«˜å¸½","ã€é ­éƒ¨ã€‘"));
equipData[28].storage.push(newItem("ğŸ›¡ï¸","é­”æ³•è­·ç›¾","ã€ç›”ç”²ã€‘"));

// å…¶ä»–å­¸ç”ŸåŒç†ï¼Œå¯ä¾éœ€æ±‚å¡«å¯«

const studentSelect=document.getElementById("studentSelect");
const equipContainer=document.getElementById("equipContainer");
const storageItems=document.getElementById("storageItems");
const tooltip=document.getElementById("tooltip");
const allContainer=document.getElementById("allContainer");
const catalogContainer=document.getElementById("catalogContainer");
const catalogSearch=document.getElementById("catalogSearch");
const powerTotalEl=document.getElementById("powerTotal");

// å‹•æ…‹ç”Ÿæˆæ ¼å­
equipSlots.forEach(slot=>{
  const div=document.createElement("div");
  div.className=`equip-slot ${slot}`;
  div.dataset.slot=slot;
  equipContainer.appendChild(div);
});

// ç”Ÿæˆå­¸ç”Ÿé¸å–®
equipData.forEach((s,i)=>{
  const opt=document.createElement("option");
  opt.value=i;
  opt.textContent=s.name;
  studentSelect.appendChild(opt);
});

function showTooltip(item){
  if(!item) return;
  tooltip.innerHTML=`<strong>${item.name}</strong><br>${item.desc || ''}<br>èƒ½åŠ›åŠ æ¬Šï¼š${Number(item.power).toFixed(3)}%`;
  tooltip.style.display="block";
  clearTimeout(tooltip._hideTimeout);
  tooltip._hideTimeout = setTimeout(()=>tooltip.style.display="none",2500);
}

function calcTotalPower(data){
  let sum = 0;
  equipSlots.forEach(p=>{ const it=data[p]; if(it) sum += parseFloat(it.power); });
  data.storage.forEach(st=>{ if(st) sum += parseFloat(st.power); });
  return sum; // value in percent (e.g., 2.345 means 2.345%)
}

function renderEquip(){
  const i=parseInt(studentSelect.value);
  const data=equipData[i];
  document.querySelectorAll(".equip-slot").forEach(slot=>{
    const part=slot.dataset.slot;
    const item=data[part];
    slot.textContent=item?item.icon:"â”";
  });
  // render storage
  storageItems.innerHTML="";
  data.storage.forEach((item,idx)=>{
    const span=document.createElement("span");
    span.className="storage-item";
    span.textContent=item.icon;
    span.title = `${item.name} (${item.desc}) - ${Number(item.power).toFixed(3)}%`;
    span.onclick=()=>showTooltip(item);
    storageItems.appendChild(span);
  });
  // show total power
  const total = calcTotalPower(data);
  powerTotalEl.textContent = `ç¸½åŠ æ¬Šï¼š${total.toFixed(3)}%`;
}

// é»æ“Šæ ¼å­é¡¯ç¤ºè£å‚™è³‡è¨Šï¼ˆå«åŠ æ¬Šï¼‰
equipContainer.addEventListener("click",(e)=>{
  const slot=e.target.closest(".equip-slot");
  if(!slot) return;
  const part=slot.dataset.slot;
  const i=parseInt(studentSelect.value);
  const item=equipData[i][part];
  if(item) showTooltip(item);
});

studentSelect.addEventListener("change",renderEquip);

// å…¨å“¡æ”»ç•¥
function renderAll(){
  allContainer.innerHTML="";
  equipData.forEach(player=>{
    const div=document.createElement("div");
    div.className="student";
    let html=`<h2>${player.name}</h2>`;
    equipSlots.forEach(p=>{
      const names={head:"é ­éƒ¨",body:"èº«é«”",hands:"æ‰‹éƒ¨",weapon:"æ­¦å™¨",legs:"è…¿éƒ¨",boots:"é‹å­",neck:"é ¸éƒ¨",waist:"è…°éƒ¨",accessory:"é£¾å“"};
      const item=player[p];
      if(item) html+=`<div class="equip-line"><span>${names[p]}</span><span class="icon">${item.icon}</span><span>${item.name} (${Number(item.power).toFixed(3)}%)</span><span>${item.desc || ''}</span></div>`;
    });
    if(player.storage.length){
      html+=`<div class="equip-line"><strong>å…¶ä»–è£å‚™ï¼š</strong></div>`;
      player.storage.forEach(st=>html+=`<div class="equip-line"><span class="icon">${st.icon}</span><span>${st.name} (${Number(st.power).toFixed(3)}%)</span><span>${st.desc}</span></div>`);
    }
    const total = calcTotalPower(player);
    html += `<div class="equip-line"><strong>ç¸½åŠ æ¬Šï¼š</strong><span>${total.toFixed(3)}%</span></div>`;
    div.innerHTML=html;
    allContainer.appendChild(div);
  });
}

// è£å‚™å¤§å…¨
function renderCatalog(){
  const query=catalogSearch.value.trim().toLowerCase();
  catalogContainer.innerHTML="";
  const allEquip={};
  equipData.forEach(player=>{
    equipSlots.forEach(part=>{
      const item=player[part];
      if(item) allEquip[`${item.name}__${item.power}`]=item; // key ensure uniqueness
    });
    player.storage.forEach(st=>allEquip[`${st.name}__${st.power}`]=st);
  });
  Object.values(allEquip).forEach(item=>{
    const nameLower = item.name.toLowerCase();
    const descLower = (item.desc||"").toLowerCase();
    const powerStr = Number(item.power).toFixed(3);
    // if query is numeric fragment, also match power
    let match = true;
    if(query){
      match = nameLower.includes(query) || descLower.includes(query) || powerStr.includes(query);
    }
    if(!match) return;
    const div=document.createElement("div");
    div.className="student";
    div.innerHTML=`<div class="equip-line"><span class="icon">${item.icon}</span><span>${item.name}</span><span>${item.desc || ''}</span><span>åŠ æ¬Šï¼š${powerStr}%</span></div>`;
    catalogContainer.appendChild(div);
  });
}

// é é¢åˆ‡æ›
const pages=document.querySelectorAll(".page");
function showPage(id){
  pages.forEach(p=>p.style.display="none");
  document.getElementById(id).style.display="block";
  if(id==="allPage") renderAll();
  if(id==="catalogPage") renderCatalog();
}

document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>showPage(btn.dataset.page));
});

// æœå°‹
catalogSearch.addEventListener("input", renderCatalog);

// é è¨­
renderEquip();
showPage("equipPage");
</script>

</body>
</html>
